<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stage 3 - ãƒ‰ãƒƒã‚­ãƒ³ã‚° | ç•œç‰©èª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

```
body {
  font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
  background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #fff;
}

.stage-header {
  text-align: center;
  margin-bottom: 20px;
}

.stage-header h1 {
  font-size: 1.5rem;
  color: #ffb6c1;
  margin-bottom: 5px;
}

.stage-header p {
  font-size: 0.9rem;
  color: #ffd1dc;
}

.condition-list {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 15px 20px;
  margin-bottom: 20px;
  min-width: 280px;
}

.condition-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  font-size: 0.95rem;
}

.condition-item:last-child {
  border-bottom: none;
}

.condition-check {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  flex-shrink: 0;
}

.condition-check.incomplete {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid #888;
}

.condition-check.complete {
  background: #90ee90;
  border: 2px solid #228b22;
}

.game-area {
  width: 320px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 20px;
  border: 3px solid #ff69b4;
}

.task-section {
  margin-bottom: 20px;
}

.task-title {
  font-size: 0.9rem;
  color: #ffd1dc;
  margin-bottom: 10px;
}

/* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
.slider-container {
  margin-bottom: 15px;
}

.slider-label {
  display: flex;
  justify-content: space-between;
  font-size: 0.8rem;
  color: #aaa;
  margin-bottom: 5px;
}

input[type="range"] {
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: #333;
  outline: none;
  -webkit-appearance: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: linear-gradient(145deg, #ff85a2, #ff5c8d);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

.slider-value {
  text-align: center;
  font-size: 1.2rem;
  color: #ffd700;
  margin-top: 5px;
}

/* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— */
.button-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.toggle-btn {
  flex: 1;
  min-width: 80px;
  padding: 10px;
  border: 2px solid #ff69b4;
  background: transparent;
  color: #ff69b4;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 0.9rem;
}

.toggle-btn.active {
  background: linear-gradient(145deg, #ff85a2, #ff5c8d);
  color: #fff;
  border-color: #ff5c8d;
}

/* çµæœ */
.dock-btn {
  width: 100%;
  padding: 15px;
  font-size: 1.1rem;
  border: none;
  border-radius: 15px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: bold;
  margin-top: 20px;
}

.dock-btn.ready {
  background: linear-gradient(145deg, #90ee90, #32cd32);
  color: #fff;
  box-shadow: 0 5px 15px rgba(50, 205, 50, 0.4);
}

.dock-btn.not-ready {
  background: #444;
  color: #888;
  cursor: not-allowed;
}

.dock-btn.ready:hover {
  transform: scale(1.02);
}

.result-screen {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.result-screen.show {
  display: flex;
}

.result-icon {
  font-size: 5rem;
  margin-bottom: 15px;
}

.result-text {
  font-size: 1.8rem;
  color: #90ee90;
  margin-bottom: 30px;
}

.nav-btn {
  padding: 15px 40px;
  font-size: 1.1rem;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  margin: 5px;
  transition: all 0.3s;
  background: linear-gradient(145deg, #87ceeb, #4fc3f7);
  color: #fff;
}

.nav-btn:hover {
  transform: scale(1.05);
}
```

  </style>
</head>
<body>
  <div class="stage-header">
    <h1>ğŸ›°ï¸ Stage 3 - ãƒ‰ãƒƒã‚­ãƒ³ã‚°</h1>
    <p>ã™ã¹ã¦ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ãƒ‰ãƒƒã‚­ãƒ³ã‚°ã—ã‚ˆã†ï¼</p>
  </div>

  <div class="condition-list">
    <div class="condition-item">
      <div class="condition-check incomplete" id="check1">âœ“</div>
      <span>æ¥è¿‘é€Ÿåº¦ã‚’ 5 m/s ä»¥ä¸‹ã«ã™ã‚‹</span>
    </div>
    <div class="condition-item">
      <div class="condition-check incomplete" id="check2">âœ“</div>
      <span>è§’åº¦ã‚’ 0Â° ã«èª¿æ•´ã™ã‚‹</span>
    </div>
    <div class="condition-item">
      <div class="condition-check incomplete" id="check3">âœ“</div>
      <span>é›»åŠ›ãƒ¢ãƒ¼ãƒ‰ã‚’ã€Œç¯€ç´„ã€ã«ã™ã‚‹</span>
    </div>
  </div>

  <div class="game-area">
    <div class="task-section">
      <div class="task-title">ğŸš€ æ¥è¿‘é€Ÿåº¦</div>
      <div class="slider-container">
        <div class="slider-label">
          <span>0 m/s</span>
          <span>20 m/s</span>
        </div>
        <input type="range" id="speedSlider" min="0" max="20" value="15" oninput="updateConditions()">
        <div class="slider-value"><span id="speedValue">15</span> m/s</div>
      </div>
    </div>

```
<div class="task-section">
  <div class="task-title">ğŸ“ è§’åº¦èª¿æ•´</div>
  <div class="slider-container">
    <div class="slider-label">
      <span>-30Â°</span>
      <span>+30Â°</span>
    </div>
    <input type="range" id="angleSlider" min="-30" max="30" value="20" oninput="updateConditions()">
    <div class="slider-value"><span id="angleValue">20</span>Â°</div>
  </div>
</div>

<div class="task-section">
  <div class="task-title">âš¡ é›»åŠ›ãƒ¢ãƒ¼ãƒ‰</div>
  <div class="button-group">
    <button class="toggle-btn active" id="powerFull" onclick="setPowerMode('full')">ãƒ•ãƒ«</button>
    <button class="toggle-btn" id="powerNormal" onclick="setPowerMode('normal')">é€šå¸¸</button>
    <button class="toggle-btn" id="powerSave" onclick="setPowerMode('save')">ç¯€ç´„</button>
  </div>
</div>

<button class="dock-btn not-ready" id="dockBtn" onclick="tryDock()">
  ğŸ”— ãƒ‰ãƒƒã‚­ãƒ³ã‚°å®Ÿè¡Œ
</button>
```

  </div>

  <div class="result-screen" id="resultScreen">
    <div class="result-icon">ğŸ‰</div>
    <div class="result-text">ãƒ‰ãƒƒã‚­ãƒ³ã‚°æˆåŠŸï¼</div>
    <button class="nav-btn" onclick="goToMap()">ğŸ—ºï¸ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒãƒƒãƒ—ã¸</button>
  </div>

  <script>
    // ==========================================
    // localStorage è¨­å®š
    // ==========================================
    const SAVE_KEY = 'save.map_chikusei_v1';
    const STAGE_ID = 'stage-03';

    // çŠ¶æ…‹
    let powerMode = 'full';

    // ==========================================
    // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç†
    // ==========================================
    function loadSaveData() {
      try {
        const raw = localStorage.getItem(SAVE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (e) {
        return null;
      }
    }

    function markStageCleared() {
      let saveData = loadSaveData();
      if (!saveData) {
        saveData = { version: 1, stages: {} };
      }
      saveData.stages[STAGE_ID] = {
        cleared: true,
        clearedAt: new Date().toISOString()
      };
      localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
    }

    // ==========================================
    // ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
    // ==========================================
    function setPowerMode(mode) {
      powerMode = mode;
      
      document.getElementById('powerFull').classList.remove('active');
      document.getElementById('powerNormal').classList.remove('active');
      document.getElementById('powerSave').classList.remove('active');
      
      if (mode === 'full') document.getElementById('powerFull').classList.add('active');
      if (mode === 'normal') document.getElementById('powerNormal').classList.add('active');
      if (mode === 'save') document.getElementById('powerSave').classList.add('active');
      
      updateConditions();
    }

    function updateConditions() {
      const speed = parseInt(document.getElementById('speedSlider').value);
      const angle = parseInt(document.getElementById('angleSlider').value);
      
      document.getElementById('speedValue').textContent = speed;
      document.getElementById('angleValue').textContent = angle;
      
      // æ¡ä»¶åˆ¤å®š
      const cond1 = speed <= 5;
      const cond2 = angle === 0;
      const cond3 = powerMode === 'save';
      
      // ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯æ›´æ–°
      updateCheck('check1', cond1);
      updateCheck('check2', cond2);
      updateCheck('check3', cond3);
      
      // ãƒ‰ãƒƒã‚­ãƒ³ã‚°ãƒœã‚¿ãƒ³æ›´æ–°
      const dockBtn = document.getElementById('dockBtn');
      if (cond1 && cond2 && cond3) {
        dockBtn.className = 'dock-btn ready';
        dockBtn.textContent = 'ğŸ”— ãƒ‰ãƒƒã‚­ãƒ³ã‚°å®Ÿè¡Œ';
      } else {
        dockBtn.className = 'dock-btn not-ready';
        dockBtn.textContent = 'âš ï¸ æ¡ä»¶æœªé”æˆ';
      }
    }

    function updateCheck(id, isComplete) {
      const el = document.getElementById(id);
      if (isComplete) {
        el.className = 'condition-check complete';
      } else {
        el.className = 'condition-check incomplete';
      }
    }

    function tryDock() {
      const speed = parseInt(document.getElementById('speedSlider').value);
      const angle = parseInt(document.getElementById('angleSlider').value);
      
      if (speed <= 5 && angle === 0 && powerMode === 'save') {
        markStageCleared();
        document.getElementById('resultScreen').classList.add('show');
      }
    }

    function goToMap() {
      window.location.href = 'index.html';
    }

    // åˆæœŸåŒ–
    updateConditions();
  </script>

</body>
</html>