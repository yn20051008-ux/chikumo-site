<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stage 1 - è»Œé“çªå…¥ | ç•œç‰©èª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

```
body {
  font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
  background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #fff;
}

.stage-header {
  text-align: center;
  margin-bottom: 20px;
}

.stage-header h1 {
  font-size: 1.5rem;
  color: #ffb6c1;
  margin-bottom: 5px;
}

.stage-header p {
  font-size: 0.9rem;
  color: #ffd1dc;
}

.game-area {
  width: 300px;
  height: 300px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  border: 3px solid #ff69b4;
}

/* ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚²ãƒ¼ãƒ ç”¨ */
.orbit-ring {
  width: 200px;
  height: 200px;
  border: 4px solid rgba(255, 105, 180, 0.3);
  border-radius: 50%;
  position: relative;
}

.target-zone {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 20px;
  background: #90ee90;
  border-radius: 5px;
}

.rocket {
  position: absolute;
  font-size: 1.5rem;
  transform-origin: center center;
}

.instruction {
  font-size: 0.9rem;
  color: #ffd1dc;
  margin: 20px 0;
  text-align: center;
}

.game-btn {
  padding: 15px 40px;
  font-size: 1.1rem;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: bold;
}

.start-btn {
  background: linear-gradient(145deg, #ff85a2, #ff5c8d);
  color: #fff;
  box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
}

.start-btn:hover {
  transform: scale(1.05);
}

.action-btn {
  background: linear-gradient(145deg, #ffd700, #ffa500);
  color: #333;
}

/* çµæœç”»é¢ */
.result-screen {
  display: none;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.result-screen.show {
  display: flex;
}

.result-icon {
  font-size: 4rem;
  margin-bottom: 10px;
}

.result-text {
  font-size: 1.5rem;
  margin-bottom: 20px;
}

.result-text.success {
  color: #90ee90;
}

.result-text.fail {
  color: #ff6b6b;
}

.nav-btn {
  padding: 12px 30px;
  font-size: 1rem;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  margin: 5px;
  transition: all 0.3s;
}

.map-btn {
  background: linear-gradient(145deg, #87ceeb, #4fc3f7);
  color: #fff;
}

.retry-btn {
  background: linear-gradient(145deg, #ff85a2, #ff5c8d);
  color: #fff;
}

.nav-btn:hover {
  transform: scale(1.05);
}

.hidden {
  display: none !important;
}
```

  </style>
</head>
<body>
  <div class="stage-header">
    <h1>ğŸ›¸ Stage 1 - è»Œé“çªå…¥</h1>
    <p>ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚ˆããƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è»Œé“ã«ä¹—ã‚ã†ï¼</p>
  </div>

  <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->

  <div class="game-area" id="gameArea">
    <div class="orbit-ring">
      <div class="target-zone"></div>
      <div class="rocket" id="rocket">ğŸš€</div>
    </div>
  </div>

  <p class="instruction" id="instruction">ç·‘ã®ã‚¾ãƒ¼ãƒ³ã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</p>

<button class="game-btn start-btn" id="startBtn" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button class="game-btn action-btn hidden" id="actionBtn" onclick="checkTiming()">ğŸ¯ ç™ºå°„ï¼</button>

  <!-- çµæœç”»é¢ -->

  <div class="result-screen" id="resultScreen">
    <div class="result-icon" id="resultIcon"></div>
    <div class="result-text" id="resultText"></div>
    <button class="nav-btn map-btn hidden" id="mapBtn" onclick="goToMap()">ğŸ—ºï¸ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒãƒƒãƒ—ã¸</button>
    <button class="nav-btn retry-btn" id="retryBtn" onclick="retry()">ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
  </div>

  <script>
    // ==========================================
    // localStorage è¨­å®š
    // ==========================================
    const SAVE_KEY = 'save.map_chikusei_v1';
    const STAGE_ID = 'stage-01';

    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let angle = 0;
    let isPlaying = false;
    let animationId = null;

    // ==========================================
    // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç†
    // ==========================================
    function loadSaveData() {
      try {
        const raw = localStorage.getItem(SAVE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (e) {
        return null;
      }
    }

    function markStageCleared() {
      let saveData = loadSaveData();
      if (!saveData) {
        saveData = {
          version: 1,
          stages: {}
        };
      }
      saveData.stages[STAGE_ID] = {
        cleared: true,
        clearedAt: new Date().toISOString()
      };
      localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
    }

    // ==========================================
    // ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
    // ==========================================
    function startGame() {
      document.getElementById('startBtn').classList.add('hidden');
      document.getElementById('actionBtn').classList.remove('hidden');
      document.getElementById('resultScreen').classList.remove('show');
      document.getElementById('gameArea').classList.remove('hidden');
      
      isPlaying = true;
      angle = 0;
      animate();
    }

    function animate() {
      if (!isPlaying) return;
      
      angle += 3; // å›è»¢é€Ÿåº¦
      if (angle >= 360) angle = 0;
      
      const rocket = document.getElementById('rocket');
      const radius = 96; // è»Œé“ã®åŠå¾„
      const radian = (angle - 90) * (Math.PI / 180);
      const x = Math.cos(radian) * radius + 96;
      const y = Math.sin(radian) * radius + 96;
      
      rocket.style.left = x + 'px';
      rocket.style.top = y + 'px';
      rocket.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
      
      animationId = requestAnimationFrame(animate);
    }

    function checkTiming() {
      if (!isPlaying) return;
      
      isPlaying = false;
      cancelAnimationFrame(animationId);
      
      // æˆåŠŸåˆ¤å®šï¼šè§’åº¦ãŒ350ã€œ360 ã¾ãŸã¯ 0ã€œ10 ã®ç¯„å›²
      const isSuccess = (angle >= 350 || angle <= 10);
      
      showResult(isSuccess);
    }

    function showResult(isSuccess) {
      document.getElementById('gameArea').classList.add('hidden');
      document.getElementById('actionBtn').classList.add('hidden');
      document.getElementById('instruction').classList.add('hidden');
      
      const resultScreen = document.getElementById('resultScreen');
      const resultIcon = document.getElementById('resultIcon');
      const resultText = document.getElementById('resultText');
      const mapBtn = document.getElementById('mapBtn');
      
      resultScreen.classList.add('show');
      
      if (isSuccess) {
        resultIcon.textContent = 'ğŸ‰';
        resultText.textContent = 'ã‚¯ãƒªã‚¢ï¼';
        resultText.className = 'result-text success';
        mapBtn.classList.remove('hidden');
        markStageCleared();
      } else {
        resultIcon.textContent = 'ğŸ’«';
        resultText.textContent = 'å¤±æ•—...';
        resultText.className = 'result-text fail';
        mapBtn.classList.add('hidden');
      }
    }

    function retry() {
      document.getElementById('resultScreen').classList.remove('show');
      document.getElementById('instruction').classList.remove('hidden');
      document.getElementById('startBtn').classList.remove('hidden');
      document.getElementById('gameArea').classList.remove('hidden');
    }

    function goToMap() {
      window.location.href = 'index.html';
    }
  </script>

</body>
</html>