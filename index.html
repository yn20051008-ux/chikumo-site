<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chicken Friends Carousel</title>
  <style>
    :root{
      --bg:#0f1020;
      --card:#141738;
      --ink:#eef2ff;
      --muted:#a8b0d9;
      --accent:#2bd4a7;
      --accent-2:#7aa2ff;
      --focus:#ffd166;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(800px 600px at 15% 5%, #15183f 0%, transparent 60%),
                  radial-gradient(800px 600px at 85% 10%, #1a1f52 0%, transparent 55%),
                  var(--bg);
      color:var(--ink);
      font:16px/1.6 system-ui, -apple-system, "Segoe UI", "Noto Sans JP", "Hiragino Sans", "Yu Gothic UI", "Meiryo", sans-serif;
    }
    .wrap{max-width:980px;margin:0 auto;padding:24px 16px}
    header{margin:12px 0 10px}
    header h1{margin:0 0 6px;font-size:clamp(22px, 4vw, 28px)}
    header p{margin:0;color:var(--muted)}
    .card{
      background:var(--card);
      border:1px solid #ffffff1a;
      border-radius:16px;
      box-shadow:0 10px 30px #0006, 0 2px 8px #0003;
      overflow:hidden;
    }

    /* Carousel */
    .carousel{
      position:relative;
      padding:10px;
    }
    .viewport{
      position:relative;
      overflow:hidden;
      border-radius:12px;
    }
    .track{
      display:flex;
      will-change:transform;
      transition:transform .5s cubic-bezier(.22,.7,.2,1);
      touch-action:pan-y;
      user-select:none;
      -webkit-user-drag:none;
    }
    .slide{
      flex:0 0 100%;
      display:flex;
      align-items:center;
      justify-content:center;
      height:clamp(300px, 52vw, 420px);
      padding:16px;
      outline:none;
    }
    .slide .stage{
      width:min(92%, 520px);
      aspect-ratio:1/1; /* square stage */
      background:#0d0f2a;
      border:1px solid #ffffff12;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: inset 0 0 0 1px #0006;
    }

    /* Chicken SVG sizing */
    .stage svg{
      width:80%;
      height:auto;
      display:block;
    }

    /* Eyes blink transform settings */
    .eye{
      transform-box: fill-box;
      transform-origin: center;
      transition: transform .08s ease;
    }
    .eye.blink{ transform: scaleY(.08); }

    /* Prev/Next buttons */
    .nav{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      z-index:5;
      display:flex;
      align-items:center;
      justify-content:center;
      width:42px;height:42px;
      border-radius:50%;
      background:#0008;
      color:#fff;
      border:1px solid #ffffff2a;
      box-shadow:0 4px 14px #0006;
      cursor:pointer;
      transition:filter .15s ease, transform .06s ease;
    }
    .nav:hover{filter:brightness(1.12)}
    .nav:active{transform:translateY(-50%) scale(.98)}
    .nav:focus-visible{outline:3px solid var(--focus)}
    .nav.prev{left:12px}
    .nav.next{right:12px}

    /* Dots */
    .dots{
      display:flex;gap:8px;justify-content:center;align-items:center;
      padding:12px 8px;
    }
    .dots button{
      width:10px;height:10px;border-radius:50%;border:0;
      background:#ffffff26;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease, box-shadow .12s ease;
    }
    .dots button[aria-current="true"]{
      background:linear-gradient(120deg, var(--accent), var(--accent-2));
      box-shadow:0 0 0 3px #ffffff14;
      transform:scale(1.2);
    }
    .dots button:focus-visible{outline:3px solid var(--focus)}

    /* Focus ring for other controls */
    button:focus-visible{outline:3px solid var(--focus);outline-offset:2px}

    /* sr-only for live region */
    .sr-only{
      position:absolute;width:1px;height:1px;padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }

    /* Responsive tweaks */
    @media (max-width:640px){
      .nav{width:38px;height:38px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>鶏キャラクターの友達カルーセル</h1>
      <p>ドラッグ / スワイプ / 矢印キー / ボタン / ドットで移動。まばたきもするよ。</p>
    </header>

    <section class="card carousel" role="region" aria-roledescription="carousel" aria-label="Chicken friends carousel">
      <div class="viewport" id="viewport">
        <div class="track" id="track" style="transform:translateX(0px)">
          <!-- slides will be injected by JS -->
        </div>
        <button class="nav prev" id="btnPrev" aria-label="前のスライドへ" type="button">‹</button>
        <button class="nav next" id="btnNext" aria-label="次のスライドへ" type="button">›</button>
      </div>
      <div class="dots" id="dots" aria-label="ページネーション" role="tablist"></div>
      <div id="live" class="sr-only" aria-live="polite"></div>
    </section>
  </div>

  <script>
  (()=>{'use strict';
    const slidesCount = 6;
    let index = 0;
    const viewport = document.getElementById('viewport');
    const track = document.getElementById('track');
    const dotsWrap = document.getElementById('dots');
    const live = document.getElementById('live');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');

    // Build slides
    const configs = [
      {accent:'hat',     color:'#7aa2ff'},
      {accent:'scarf',   color:'#ff7aa8'},
      {accent:'crown',   color:'#ffd166'},
      {accent:'cheeks',  color:'#ff9ab5'},
      {accent:'bow',     color:'#9b7bff'},
      {accent:'band',    color:'#2bd4a7'}
    ];

    const slideEls = [];
    for(let i=0;i<slidesCount;i++){
      const slide = document.createElement('div');
      slide.className = 'slide';
      slide.id = `slide-${i}`;
      slide.setAttribute('role','group');
      slide.setAttribute('aria-label', `Slide ${i+1} of ${slidesCount}`);

      const stage = document.createElement('div');
      stage.className = 'stage';
      const chicken = createChickenSVG(configs[i % configs.length]);
      stage.appendChild(chicken);
      slide.appendChild(stage);
      track.appendChild(slide);
      slideEls.push(slide);
    }

    // Build dots
    const dots = [];
    for(let i=0;i<slidesCount;i++){
      const b = document.createElement('button');
      b.type = 'button';
      b.setAttribute('role','tab');
      b.setAttribute('aria-controls', `slide-${i}`);
      if(i===0) b.setAttribute('aria-current','true');
      b.addEventListener('click', ()=>goTo(i, true));
      dotsWrap.appendChild(b);
      dots.push(b);
    }

    // Resize handling
    let slideW = viewport.clientWidth;
    const recalc = ()=>{
      slideW = viewport.clientWidth;
      applyTransform();
    };
    const ro = new ResizeObserver(recalc);
    ro.observe(viewport);
    window.addEventListener('orientationchange', ()=>setTimeout(recalc, 200));

    // Transform
    function applyTransform(){
      track.style.transform = `translateX(${-index * slideW}px)`;
    }
    function announce(){
      live.textContent = `Slide ${index+1} of ${slidesCount}`;
    }
    function updateUI(){
      dots.forEach((d,i)=>{
        if(i===index){ d.setAttribute('aria-current','true'); }
        else{ d.removeAttribute('aria-current'); }
      });
      announce();
    }
    function goTo(i, announceNow=false){
      index = Math.max(0, Math.min(slidesCount-1, i));
      track.style.transition = 'transform .5s cubic-bezier(.22,.7,.2,1)';
      applyTransform();
      updateUI();
      if(!announceNow){ /* no-op; announce already in updateUI */ }
    }
    function prev(){ goTo(index-1, true); }
    function next(){ goTo(index+1, true); }

    // Buttons
    btnPrev.addEventListener('click', prev);
    btnNext.addEventListener('click', next);

    // Keyboard: left/right/home/end
    viewport.tabIndex = 0;
    viewport.addEventListener('keydown', (e)=>{
      const k = e.key;
      if(k === 'ArrowLeft'){ e.preventDefault(); prev(); }
      else if(k === 'ArrowRight'){ e.preventDefault(); next(); }
      else if(k === 'Home'){ e.preventDefault(); goTo(0, true); }
      else if(k === 'End'){ e.preventDefault(); goTo(slidesCount-1, true); }
    });

    // Drag/Swipe
    let isDown = false, startX = 0, baseX = 0, dx = 0, pointerId = null, moved = false;
    const threshold = 50;

    function onDown(e){
      isDown = true; moved=false;
      dx = 0; startX = getX(e); baseX = -index*slideW;
      pointerId = e.pointerId;
      track.style.transition = 'none';
      viewport.setPointerCapture && pointerId!=null && viewport.setPointerCapture(pointerId);
    }
    function onMove(e){
      if(!isDown) return;
      dx = getX(e) - startX;
      track.style.transform = `translateX(${baseX + dx}px)`;
      if(Math.abs(dx) > 4) moved=true;
    }
    function onUp(){
      if(!isDown) return;
      isDown = false;
      track.style.transition = 'transform .45s cubic-bezier(.22,.7,.2,1)';
      if(dx < -threshold) next();
      else if(dx > threshold) prev();
      else applyTransform();
    }
    function getX(e){ return e.touches ? e.touches[0].clientX : e.clientX; }

    viewport.addEventListener('pointerdown', onDown, {passive:true});
    window.addEventListener('pointermove', onMove, {passive:true});
    window.addEventListener('pointerup', onUp, {passive:true});
    // Touch fallback
    viewport.addEventListener('touchstart', onDown, {passive:true});
    window.addEventListener('touchmove', onMove, {passive:true});
    window.addEventListener('touchend', onUp, {passive:true});

    // Initial
    recalc();
    updateUI();

    // -------- SVG Chicken + Blink ----------
    function createChickenSVG(cfg){
      const NS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(NS, 'svg');
      svg.setAttribute('viewBox','0 0 200 200');
      svg.setAttribute('aria-hidden', 'true');

      // Body
      const body = document.createElementNS(NS, 'ellipse');
      body.setAttribute('cx','100'); body.setAttribute('cy','110');
      body.setAttribute('rx','58');  body.setAttribute('ry','50');
      body.setAttribute('fill','#fff');
      svg.appendChild(body);

      // Beak
      const beak = document.createElementNS(NS, 'polygon');
      beak.setAttribute('points','120,100 150,90 150,110');
      beak.setAttribute('fill','#f3a43e');
      svg.appendChild(beak);

      // Eyes (wrap in group for easy blink)
      const eyeL = document.createElementNS(NS, 'g'); eyeL.setAttribute('class','eye');
      const eyeR = document.createElementNS(NS, 'g'); eyeR.setAttribute('class','eye');

      const cL = document.createElementNS(NS,'circle');
      cL.setAttribute('cx','85'); cL.setAttribute('cy','95'); cL.setAttribute('r','5'); cL.setAttribute('fill','#111');
      const cR = document.createElementNS(NS,'circle');
      cR.setAttribute('cx','110'); cR.setAttribute('cy','95'); cR.setAttribute('r','5'); cR.setAttribute('fill','#111');
      eyeL.appendChild(cL); eyeR.appendChild(cR);
      svg.appendChild(eyeL); svg.appendChild(eyeR);

      // Accents
      switch(cfg.accent){
        case 'hat': {
          const hat = document.createElementNS(NS,'path');
          hat.setAttribute('d','M60 70 Q100 50 140 70 L140 78 Q100 62 60 78 Z');
          hat.setAttribute('fill', cfg.color);
          svg.appendChild(hat);
          break;
        }
        case 'scarf': {
          const scarf = document.createElementNS(NS,'path');
          scarf.setAttribute('d','M70 140 Q100 128 130 140 L130 150 Q100 138 70 150 Z');
          scarf.setAttribute('fill', cfg.color);
          const knot = document.createElementNS(NS,'circle');
          knot.setAttribute('cx','100'); knot.setAttribute('cy','144'); knot.setAttribute('r','5'); knot.setAttribute('fill', cfg.color);
          svg.appendChild(scarf); svg.appendChild(knot);
          break;
        }
        case 'crown': {
          const crown = document.createElementNS(NS,'polygon');
          crown.setAttribute('points','85,58 95,78 105,58 115,78 125,58 125,68 85,68');
          crown.setAttribute('fill', cfg.color);
          svg.appendChild(crown);
          break;
        }
        case 'cheeks': {
          const chL = document.createElementNS(NS,'circle');
          chL.setAttribute('cx','70'); chL.setAttribute('cy','112'); chL.setAttribute('r','7'); chL.setAttribute('fill', cfg.color);
          const chR = document.createElementNS(NS,'circle');
          chR.setAttribute('cx','130'); chR.setAttribute('cy','112'); chR.setAttribute('r','7'); chR.setAttribute('fill', cfg.color);
          svg.appendChild(chL); svg.appendChild(chR);
          break;
        }
        case 'bow': {
          const bowL = document.createElementNS(NS,'polygon');
          bowL.setAttribute('points','90,140 76,132 76,148');
          bowL.setAttribute('fill', cfg.color);
          const bowR = document.createElementNS(NS,'polygon');
          bowR.setAttribute('points','110,140 124,132 124,148');
          bowR.setAttribute('fill', cfg.color);
          const knot = document.createElementNS(NS,'circle');
          knot.setAttribute('cx','100'); knot.setAttribute('cy','140'); knot.setAttribute('r','5'); knot.setAttribute('fill','#fff');
          svg.appendChild(bowL); svg.appendChild(bowR); svg.appendChild(knot);
          break;
        }
        case 'band': {
          const band = document.createElementNS(NS,'rect');
          band.setAttribute('x','62'); band.setAttribute('y','118');
          band.setAttribute('width','76'); band.setAttribute('height','10');
          band.setAttribute('rx','5'); band.setAttribute('fill', cfg.color);
          svg.appendChild(band);
          break;
        }
      }

      // Independent blink per chicken
      const eyes = [eyeL, eyeR];
      (function blinkLoop(){
        const wait = 2000 + Math.random()*4000; // 2–6s
        setTimeout(()=>{
          eyes.forEach(e=>e.classList.add('blink'));
          setTimeout(()=>eyes.forEach(e=>e.classList.remove('blink')), 140);
          blinkLoop();
        }, wait);
      })();

      return svg;
    }

  })();
  </script>
</body>
</html>
