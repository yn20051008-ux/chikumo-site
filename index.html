<!doctype html><html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ちくも | 公式サイト</title>
<meta name="description" content="ちくも公式サイト。SVGレイヤーで再現性の高いキャラクター表現を公開。">
<link rel="canonical" href="https://chikumo.jp/">
<link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="manifest" href="/manifest.webmanifest">
<meta property="og:type" content="website"><meta property="og:title" content="ちくも | 公式サイト">
<meta property="og:description" content="SVGレイヤーで再現性の高いキャラクター表現を公開。">
<meta property="og:url" content="https://chikumo.jp/"><meta property="og:image" content="https://chikumo.jp/favicon.svg">
<meta name="twitter:card" content="summary_large_image">
<!-- 外部CSSが存在しないため読み込みを停止し、ベーススタイルを内包 -->
<!-- <link rel="stylesheet" href="/assets/site.css"> -->
<style>
  /* ===== Global: CSS (Base) ===== */
  :root{--bg:#fff7f0;--ink:#222;--brand:#f4a300}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.7 system-ui,-apple-system,"Noto Sans JP",sans-serif;overflow-x:hidden;min-height:100svh;display:flex;flex-direction:column}
  html,body{overscroll-behavior-x:none;height:auto}
  a{color:inherit;text-decoration:none}
  img,svg{max-width:100%;height:auto}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}
  /* ===== Header/Footer: CSS ===== */
  header,footer{border-top:1px solid #0000000f;border-bottom:1px solid #0000000f;background:#fff}
  header{
    position: sticky;
    top: 0;
    z-index: 1000;
    padding-top: env(safe-area-inset-top);
    padding-top: constant(safe-area-inset-top);
  }
  /* footer: fixed at bottom across all viewport sizes */
  footer{
    position: fixed;
    left: 0; right: 0; bottom: 0;
    z-index: 999;
    padding-bottom: env(safe-area-inset-bottom);
    padding-bottom: constant(safe-area-inset-bottom);
  }
  footer .wrap{display:flex;justify-content:center;align-items:center;padding:2px 12px}
  footer small{line-height:1}
  /* minimize header height: override wrap padding inside header */
  header .wrap{padding:4px 16px}
  h1{font-size:clamp(28px,4vw,40px);margin:0}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
  .card{background:#fff;border:1px solid #0001;border-radius:12px;padding:16px}
  .btn{display:inline-block;padding:.6em 1em;border:1px solid #0002;border-radius:999px;background:var(--brand);color:#000}
  small,footer{color:#555}
  main{padding-inline:16px;flex:1 0 auto;padding-bottom:var(--footer-h,0px)}
  /* minimize distance between header and footer */
  main.wrap{padding:0 16px}
  /* ===== Header: CSS (Nav/Brand/SNS) ===== */
  nav.main{display:flex;gap:16px;align-items:center}
  nav.main .spacer{flex:1}
  nav.main .socials{display:flex;gap:12px;align-items:center}
  nav.main .socials svg{width:24px;height:24px;display:block;fill:#111;transition:opacity .2s ease}
  nav.main .socials a:hover svg{opacity:.7}
  /* brand: かわいい丸ゴ寄りのシステムフォント優先 */
  nav.main .brand{
    font-family: "Hiragino Maru Gothic ProN","Hiragino Maru Gothic Pro","Yu Gothic UI","Yu Gothic","Meiryo",system-ui,-apple-system,"Noto Sans JP",sans-serif;
    font-weight:700;
    letter-spacing:.02em;
    font-size:18px;
    line-height:1;
  }
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  /* ===== Birds: CSS (Slider/Stage) ===== */
  #stage{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:nowrap;width:100%;margin:0 auto;overflow:visible;touch-action:pan-x;overscroll-behavior-x:contain}
  #stage svg{display:block;width:100%;height:auto;max-width:100%;min-width:0;
    /* Fit bird within viewport height (minus header/dots/footer) */
    max-height: calc(100svh - var(--header-h, 0px) - var(--dots-h, 42px) - var(--footer-h, 0px) - 16px);
  }
  /* Mobile: horizontal slider (scroll-snap) */
  @media (max-width: 600px){
    nav.main{gap:8px}
    nav.main .brand{font-size:16px}
    .wrap{padding:16px}
    main.wrap{padding:0 12px}
    #stage{flex-wrap:nowrap;gap:0;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scrollbar-width:none;touch-action:pan-x;overscroll-behavior-x:contain}
    #stage::-webkit-scrollbar{display:none}
    #stage svg{flex:0 0 100%;scroll-snap-align:center; scroll-snap-stop: always}
  }
  /* PC/tablet: full-bleed slider like mobile (one per view) */
  @media (min-width: 601px){
    #stage{
      flex-wrap:nowrap; gap:0; overflow-x:auto;
      /* Disable snap on PC to avoid interference with programmatic scroll */
      scroll-snap-type:none; -webkit-overflow-scrolling:touch; scrollbar-width:none;
      inline-size:100vw; margin-inline:calc(50% - 50vw);
    }
    #stage::-webkit-scrollbar{display:none}
    #stage svg{flex:0 0 100%; scroll-snap-align:center; scroll-snap-stop: always}
  }
  /* ===== Misc: CSS (Optional background/effects) ===== */
  body.fun-bg{
    --g1:#fff7f0; --g2:#fff4ff; --g3:#f0fff7;
    background: radial-gradient(1200px 600px at 10% 10%, var(--g1), transparent 70%),
                radial-gradient(800px 400px at 90% 20%, var(--g2), transparent 70%),
                radial-gradient(900px 500px at 30% 90%, var(--g3), transparent 70%), var(--bg);
    background-attachment: fixed;
  }
  #tagline{margin:6px 0 10px;color:#444}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:8px 0 8px}
  .controls .hint{opacity:.7;font-size:.9em}
  .btn{position:relative;cursor:pointer;transition:transform .08s ease,box-shadow .2s ease}
  .btn:active{transform:translateY(1px)}
  /* effects (legacy) */
  .floater{position:fixed;left:0;top:100vh;font-size:22px;opacity:.85;pointer-events:none;animation:float-up linear forwards}
  @keyframes float-up{0%{transform:translate(var(--x,0),0) scale(1) rotate(0deg);opacity:0}10%{opacity:1}100%{transform:translate(calc(var(--x,0) + 40px), -110vh) scale(1.1) rotate(18deg);opacity:0}}
  .confetti-piece{position:fixed;left:0;top:0;width:8px;height:12px;opacity:.9;pointer-events:none;will-change:transform,opacity;animation:confetti-fall var(--dur,1200ms) ease-out forwards;transform:translate(var(--sx),var(--sy)) rotate(var(--rot))}
  @keyframes confetti-fall{0%{opacity:0;transform:translate(var(--sx),var(--sy)) rotate(var(--rot))}10%{opacity:1}100%{opacity:0;transform:translate(calc(var(--sx) + var(--dx)), calc(var(--sy) + var(--dy))) rotate(calc(var(--rot) + 540deg))}}
  .sparkle{position:fixed;left:0;top:0;font-size:14px;opacity:0;pointer-events:none;animation:spark .7s ease-out forwards}
  @keyframes spark{0%{opacity:0;transform:translate(var(--x),var(--y)) scale(.6)}20%{opacity:1}100%{opacity:0;transform:translate(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy))) scale(1)}}
  #stage.shake{animation:shake .35s ease-in-out}
  @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(5px)}60%{transform:translateX(-3px)}80%{transform:translateX(2px)}}

  /* ===== Slider Controls: CSS (Dots) ===== */
  .slider-controls{display:flex;justify-content:center;align-items:center;gap:12px;margin:8px 0}
  .slider-dots{display:flex;gap:8px}
  .slider-dots button{width:10px;height:10px;border-radius:50%;border:0;background:#0003;cursor:pointer}
  .slider-dots button[aria-current="true"]{background:var(--brand)}
 </style>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"Organization","name":"Chikumo","url":"https://chikumo.jp/","logo":"https://chikumo.jp/favicon.svg","sameAs":["https://x.com/","https://www.youtube.com/"]}
</script>
</head><body>
<!-- ===== Header: HTML START ===== -->
<header><div class="wrap"><nav class="main"><span class="brand">ちくも</span>
  <a href="/chara-ranking.html" aria-label="キャラ ランキング">キャラ ランキング</a>
  <span class="spacer"></span><div class="socials">
  <a class="social" href="https://x.com/YN2005100816" target="_blank" rel="noopener noreferrer" aria-label="公式X">
    <svg viewBox="0 0 256 256" aria-hidden="true" focusable="false">
      <path d="M172 56h28l-63 73 72 71h-37l-55-55-47 55H42l68-80-73-64h39l51 47 45-47z" />
    </svg>
  </a>
  <a class="social" href="https://www.youtube.com/@chikumonogatari" target="_blank" rel="noopener noreferrer" aria-label="公式YouTube">
    <svg viewBox="0 0 256 256" aria-hidden="true" focusable="false">
      <defs>
        <mask id="ytm">
          <rect width="256" height="256" fill="#fff"/>
          <polygon points="110,90 190,128 110,166" fill="#000"/>
        </mask>
      </defs>
      <rect x="0" y="38" width="256" height="180" rx="36" mask="url(#ytm)" />
    </svg>
  </a>
  </div></nav></div></header>
<!-- ===== Header: HTML END ===== -->
<main class="wrap">
<style>
  /* SVGのtransformが素直に効くように */
  #stage svg *, #stage * { transform-box: fill-box; transform-origin: center; }
  /* 上記は既存CSSを壊さず、要素単位のtransform原点を安定化 */
 </style>
<script src="js/eyes.js" defer></script>
<!-- ===== Birds: HTML START ===== -->
<div id="stage">
  <svg data-full="1" id="_レイヤー_1" data-name="レイヤー 1" xmlns="http://www.w3.org/2000/svg" viewBox="-40 -40 284.99 342.72" preserveAspectRatio="xMidYMid meet" overflow="visible">
    <defs>
      <style>
        .cls-1 { fill: #eda97b; }
        .cls-2 { fill: #eca678; }
        .cls-3 { fill: #1a2728; }
        .cls-4 { fill: #15282c; }
        .cls-5 { fill: #f5e7c6; }
        .cls-6 { fill: #b1c3cc; }
        .cls-7 { fill: #d7d2be; }
        .cls-8 { fill: #162425; }
        .cls-9 { fill: #ea9e3f; }
        .cls-10 { fill: #eb9f3f; }
        .cls-11 { fill: #dbd4be; }
        .cls-12 { fill: #f3a43e; }
        .cls-13 { fill: #90a7b3; }
        /* 白パーツは透過に変更（背景白を残さないため） */
        .cls-14 { fill: none; }
        .cls-15 { fill: #de963d; }
        .cls-16 { fill: #12242a; }
        .cls-17 { fill: #e26b3b; }
        .cls-18 { fill: #829aa4; }
        .cls-19 { fill: #15282b; }
        .cls-20 { fill: #1c2929; }
      </style>
    </defs>
    <g id="NEAiP9.tif">
      <g>
        <!-- Removed large white backdrop path (id=bgWhite) to avoid white background fill -->
        <path class="cls-16" d="M96.6,0c10.55.81,15.51,5.73,18.55,15.33,20.03-8.15,27.89,4.01,29.27,22.56,32.52,11.85,59.49,36.87,60.57,74.28v20.66c-4.4,15.98-10.46,31.41-23.67,42.27-2.26,1.86-11.14,6.48-11.39,7.14-1.33,3.46,2.42,3.82,2.66,4.21,5.17,8.47,11.02,18.58,6.3,28.74-5.49,11.81-15.56,2.19-19.44,4.14-.73.37-4.81,10.68-8.28,14.21-4.3,4.39-9.16,5.17-12.54,7.77-.95,1.88-.96,1.96,0,3.69.79.65,4.84,1.77,5.19,2.72.72,2,.25,9.16-2.24,10.56-.76.56-1.49,1.06-2.21,1.48-9.03,3.58-26.69,1.79-22.86-11.81h-25.44c-1.47,0-.93,5.59-1.66,7.19-4.4,9.63-36.59,8.64-26.27-7.79.52-.82,3.58-1.96,3.97-2.36.44-1.42.05-2.49-.74-3.69-3.31-2.49-8.62-4.02-11.55-6.89-3.12-3.05-7.75-14.69-8.52-15.09-2.49-1.28-12.03,6.51-18.68-2.34-6.05-8.04-.25-22.74,5.01-30.1.6-.85,3.17-.64,3.42-1.01,2.79-4.17-8.13-7.8-11.12-10.3C-17.74,139.85.21,65.96,48.49,44.32c2.46-1.19,16-4.45,16.85-5.13s1.89-14.69,2.72-17.93c2.95-11.54,12.78-20.19,24.85-21.26h3.69Z"/>
        <path class="cls-14" d="M96.6,0h108.4v112.17c-4.24-26.29-15.21-47.39-38.01-61.96-4.32-2.76-22.73-10.11-23.53-11.13-2.91-3.72-.15-16.43-8.15-22.1-8.84-6.28-20.09.6-21,0-.59-.39-3.2-9.25-6.72-12.11l-10.99-4.87Z"/>
        <!-- 足元の灰色ノイズ（汚れ）を削除 -->
        <path class="cls-5" d="M134.2,43.54c58.45,11.86,89.77,88.13,40.16,128.38-2.11,1.71-13.29,7.9-13.52,8.67-.5,1.69,10.64,14.4,12.03,19.44,1.38,4.98,2.94,16.76-5.78,15.45-10.1-1.52-3.91-19.02-10.26-16.11-2.27,1.04-.95,23.19-13.1,32.66-19.25,15.01-82.07,14.22-91.74-13.61-1.47-4.22-.63-17.64-3.07-18.39-4.84-1.48-3.66,8.3-4.28,10.32-1.48,4.79-9.12,7.35-12.24,2.58-7.54-11.51,13.46-29.59,13.21-31.59-.23-1.82-14.64-9.42-17.95-12.38-46.29-41.29-11.04-116.15,46.81-126.17l1.83-1.79c18.56-2.4,37.63-2.22,56.12.69l1.78,1.84Z"/>
        <path class="cls-17" d="M134.2,43.54c-16.24-3.3-43.47-3.55-59.73-.74-5.87-16.4,2.86-37.45,22.54-34.73,13.15,1.81,10.81,20.35,14.84,21.38,2.6.66,6.24-7.11,11.1-7.88,12-1.9,15.33,13.02,11.25,21.97Z"/>
        <path class="cls-15" d="M80.99,245.13c.23.21,3.1,5.18,3.11,5.49.24,6.22-14.64,5.94-16.65,2.52s6.52-4.65,6.93-5.28c.57-.87-.26-3.86.11-4.33.21-.26,6.26,1.37,6.51,1.59Z"/>
        <path class="cls-10" d="M131.25,243.53c.15.13-.14,3.07.8,4.01,1.56,1.56,13.72,6.73,1.04,7.78-21.2,1.75-4.57-14.15-1.84-11.79Z"/>
        <path class="cls-2" d="M164.31,124.89c17.15-1.88,21.87,25.65,4.14,28.55-22.15,3.62-23.57-26.43-4.14-28.55Z"/>
        <path class="cls-8" d="M116.24,152.49c-18.33,16.32-42.94-11.17-26.04-26.05,18.86-16.61,42.46,11.43,26.04,26.05Z"/>
        <path class="cls-1" d="M48.66,147.6c-.36.34,3,3.64-6.29,5.16-.24.04-.45-1.52-.72-1.52-1.65.03-2.86,1.59-3.67,1.47-18.78-2.63-14.76-31.54,5.84-27.94,9.7,1.7,14.25,14.66,8.22,22.14-.73.9-3.24.55-3.38.69Z"/>
        <path class="cls-4" d="M76.27,129.46c-16.34,11.58-27.65-15.68-12.31-21.54,14.83-5.66,24.7,12.76,12.31,21.54Z"/>
        <path class="cls-19" d="M134.74,107.18c18.82-3.47,19.86,24.58,2.67,24.86-14.74.24-16.23-22.36-2.67-24.86Z"/>
        <path class="cls-3" d="M147.97,86.58c7.68,8.94-6.09,2.5-7.68,2.15-2.63-.58-9.64,1.1-9.81-2.04-.29-5.11,14.24-3.9,17.49-.12Z"/>
        <path class="cls-20" d="M74.33,85.01c3.71,5.44-6.4,3.2-8.28,3.61-2.27.49-7.96,4.94-9.22,1.7-2.12-5.44,14.69-9.43,17.51-5.31Z"/>
        <path class="cls-12" d="M114.97,136.45c-.86,1.34-32.39,5.48-21-5.88,7.65-7.62,24.51.39,21,5.88Z"/>
        <path class="cls-9" d="M115.77,142.43c.97,13.9-29.04,9.13-25.08.38.52-1.14,21.76,2.17,25.08-.38Z"/>
        <path class="cls-7" d="M72.05,113.73c3.7-.91,4.33,5.81.58,5.83-2.98.01-3.58-5.09-.58-5.83Z"/>
        <path class="cls-11" d="M142.87,114.58c2.99,3.01-2.42,6.95-4.65,3.52-1.79-2.76,2.15-6.03,4.65-3.52Z"/>
      </g>
    </g>
  </svg>
 </div>
<div class="slider-controls" aria-label="Slider controls">
  <div class="slider-dots" id="stage-dots" role="tablist" aria-label="ページネーション"></div>
<!-- ===== Birds: HTML END ===== -->
<script>
// ===== Birds: JS (Duplicate 3) =====
// Ensure exactly 3 real birds; remove extras; assign stable IDs
(function(){
  const stage=document.getElementById('stage');
  if(!stage) return;
  const first=stage.querySelector('svg');
  if(!first) return;
  function cleanIds(root){
    root.removeAttribute('id');
    root.querySelectorAll('[id]').forEach(el=>el.removeAttribute('id'));
  }
  const DESIRED = 3;
  // Remove extras beyond 3 (exclude loop clones)
  let reals = Array.from(stage.querySelectorAll('svg:not([data-clone])'));
  while(reals.length > DESIRED){
    const last = reals.pop();
    last.remove();
  }
  // Duplicate until we have exactly 3
  while(reals.length < DESIRED){
    const clone = first.cloneNode(true);
    cleanIds(clone);
    stage.appendChild(clone);
    reals = Array.from(stage.querySelectorAll('svg:not([data-clone])'));
  }
  // Assign stable IDs to the three real birds
  reals.forEach((svg,i)=>{ svg.removeAttribute('id'); svg.id = `bird-${i+1}`; });
})();
</script>
<!-- ===== Birds: JS (Duplicate 3) END ===== -->
<script>
// ===== Birds: JS (Auto-slide) =====
// RealIndex + Virtual 3-step, recursive setTimeout, robust wrap handling
(function(){
  const stage = document.getElementById('stage');
  if(!stage) return;

  const dotsWrap = document.getElementById('stage-dots');
  const btnPrev  = document.getElementById('nav-prev');
  const btnNext  = document.getElementById('nav-next');

  const V_STEPS = 3;                 // 仮想ステップ数（=表示ドット数）
  let INTERVAL_MS = 3000;            // ステップ間隔（reduce-motion で上書き可）
  const SETTLE_MS = 480;             // スムース完了待ちフォールバック

  let slideW = 0;                    // 幅（setup/resizeのみ更新）
  let realCount = 0;                 // 実スライド枚数（非クローン）
  let realIndex = 0;                 // 0..realCount-1
  let v = 0;                         // 仮想インデックス 0..V_STEPS-1
  let isAnimating = false;           // スクロール中フラグ
  let autoT = null;                  // 自動送りタイマー
  let userInteracting = false;       // ユーザー操作中

  function cleanIds(root){
    root.removeAttribute('id');
    root.querySelectorAll('[id]').forEach(el=>el.removeAttribute('id'));
  }

  // 位置計算（前クローンぶん+1）
  function posForReal(i){ return (i + 1) * slideW; }
  function jumpToReal(i){
    const prev = stage.style.scrollBehavior;
    stage.style.scrollBehavior = 'auto';
    stage.scrollTo({ left: posForReal(i), behavior:'auto' });
    stage.style.scrollBehavior = prev || '';
  }
  function smoothToLeft(x){ stage.scrollTo({ left:x, behavior:'smooth' }); }

  // Robust scroll settle detector (prefers scrollend, falls back to idle polling)
  function onScrollSettled(target, cb, timeout=800){
    let done = false; let t = null;
    const finish = ()=>{ if(done) return; done=true; target.removeEventListener('scrollend', finish); if(t) clearTimeout(t); cb(); };
    if('onscrollend' in window){
      target.addEventListener('scrollend', finish, {once:true});
      t = setTimeout(finish, timeout); // safety timeout
      return;
    }
    let last = target.scrollLeft;
    const tick = ()=>{
      const cur = target.scrollLeft;
      if(Math.abs(cur - last) < 0.5){ finish(); }
      else { last = cur; t = setTimeout(tick, 50); }
    };
    t = setTimeout(tick, 50);
  }

  function goToReal(nextReal, smooth=true){
    if(realCount <= 0) return;
    const target = ((nextReal % realCount) + realCount) % realCount;
    const from = realIndex;
    const fwdWrap = from === realCount - 1 && target === 0;
    const backWrap = from === 0 && target === realCount - 1;

    // Pre-highlight target dot to avoid momentary mismatch during wrap
    realIndex = target;
    updateDots();

    isAnimating = true;
    const finish = () => { realIndex = target; jumpToReal(realIndex); updateDots(); isAnimating = false; };
    if(!smooth){ finish(); return; }

    if(fwdWrap){
      smoothToLeft((realCount + 1) * slideW);
      onScrollSettled(stage, finish, SETTLE_MS+200);
    } else if(backWrap){
      smoothToLeft(0);
      onScrollSettled(stage, finish, SETTLE_MS+200);
    } else {
      smoothToLeft(posForReal(realIndex));
      onScrollSettled(stage, () => { updateDots(); isAnimating=false; }, SETTLE_MS+200);
    }
  }

  // 仮想→実体の等分マッピング
  function realFromVirtual(vIdx){
    if(realCount <= 1) return 0;
    return Math.round(vIdx * (realCount - 1) / Math.max(1, (V_STEPS - 1)));
  }
  function virtualFromReal(rIdx){
    if(realCount <= 1) return 0;
    return Math.round(rIdx * Math.max(1, (V_STEPS - 1)) / Math.max(1, (realCount - 1)));
  }

  function goToVirtual(vIdx, smooth=true){
    v = ((vIdx % V_STEPS) + V_STEPS) % V_STEPS;
    const r = realFromVirtual(v);
    goToReal(r, smooth);
    updateDots();
  }

  function buildDots(){
    if(!dotsWrap) return;
    dotsWrap.innerHTML='';
    if(realCount <= 1 || V_STEPS <= 1){ dotsWrap.style.display = 'none'; return; }
    dotsWrap.style.display = '';
    for(let i=0;i<V_STEPS;i++){
      const b=document.createElement('button');
      b.id = `dot-${i+1}`;
      b.type='button'; b.setAttribute('role','tab');
      b.setAttribute('aria-controls', `bird-${i+1}`);
      b.addEventListener('click',()=>{ pauseAuto(); v=i; goToReal(i,true); resumeAuto(); });
      dotsWrap.appendChild(b);
    }
  }
  function updateDots(){
    if(!dotsWrap) return;
    // Highlight dot 1..3 when realIndex is 0..2; remove highlight otherwise
    const cur = (realIndex >=0 && realIndex < V_STEPS) ? realIndex : -1;
    [...dotsWrap.children].forEach((d,i)=>{
      if(i===cur) d.setAttribute('aria-current','true'); else d.removeAttribute('aria-current');
    });
  }

  function scheduleNext(){
    clearTimeout(autoT);
    // Advance by one virtual step, then chain after settle and interval
    goToVirtual(v+1, true);
    onScrollSettled(stage, ()=>{
      const plan = () => {
        if(userInteracting || isAnimating){
          clearTimeout(autoT);
          autoT = setTimeout(plan, 300);
        } else {
          clearTimeout(autoT);
          autoT = setTimeout(scheduleNext, INTERVAL_MS);
        }
      };
      plan();
    }, SETTLE_MS+200);
  }
  function startAuto(){ clearTimeout(autoT); scheduleNext(); }
  function pauseAuto(){ clearTimeout(autoT); }
  function resumeAuto(){ scheduleNext(); }

  function setup(){
    const svgs = Array.from(stage.querySelectorAll('svg'));
    if(svgs.length === 0) return;
    if(!stage.querySelector('svg[data-clone]')){
      const first = svgs[0];
      const last  = svgs[svgs.length-1];
      const firstClone = first.cloneNode(true); cleanIds(firstClone); firstClone.dataset.clone = 'first';
      const lastClone  = last.cloneNode(true);  cleanIds(lastClone);  lastClone.dataset.clone  = 'last';
      stage.insertBefore(lastClone, stage.firstChild);
      stage.appendChild(firstClone);
    }
    realCount = stage.querySelectorAll('svg:not([data-clone])').length;
    slideW = stage.clientWidth || stage.getBoundingClientRect().width;
    realIndex = 0; v = 0;
    jumpToReal(realIndex);
    buildDots();
    updateDots();
    bindNav();
    startAuto();
  }

  function bindNav(){
    btnPrev && btnPrev.addEventListener('click',()=>{ pauseAuto(); goToVirtual(v-1,true); resumeAuto(); });
    btnNext && btnNext.addEventListener('click',()=>{ pauseAuto(); goToVirtual(v+1,true); resumeAuto(); });
  }

  // ユーザー操作時の一時停止と再開（v再計算）
  stage.addEventListener('pointerdown', ()=>{ userInteracting=true; pauseAuto(); }, {passive:true});
  window.addEventListener('pointerup', ()=>{ userInteracting=false; v = virtualFromReal(realIndex); setTimeout(resumeAuto, 150); }, {passive:true});
  stage.addEventListener('touchstart', ()=>{ userInteracting=true; pauseAuto(); }, {passive:true});
  window.addEventListener('touchend', ()=>{ userInteracting=false; v = virtualFromReal(realIndex); setTimeout(resumeAuto, 150); }, {passive:true});

  // 手動スクロール同期（誤差に強いfloor+閾値）
  let scrollT = null;
  stage.addEventListener('scroll', ()=>{
    if(scrollT) clearTimeout(scrollT);
    const w = slideW || stage.clientWidth || stage.getBoundingClientRect().width;
    const cloneIdx = Math.floor((stage.scrollLeft + 0.5 * Math.max(1, w)) / Math.max(1, w)); // 0..realCount+1
    scrollT = setTimeout(()=>{
      let candidate = cloneIdx - 1; // 0..realCount-1 expected
      if(candidate < 0){ realIndex = realCount - 1; jumpToReal(realIndex); }
      else if(candidate >= realCount){ realIndex = 0; jumpToReal(realIndex); }
      else { realIndex = candidate; }
      v = virtualFromReal(realIndex);
      updateDots();
    }, 100);
  }, {passive:true});

  // リサイズ: debounceして stop→測定→現在位置へjump→再開
  let resizeT=null;
  window.addEventListener('resize', ()=>{
    pauseAuto();
    clearTimeout(resizeT);
    resizeT = setTimeout(()=>{
      slideW = stage.clientWidth || stage.getBoundingClientRect().width;
      jumpToReal(realIndex);
      resumeAuto();
    }, 150);
  });

  // 非表示タブ制御: pause/resume + 再計算
  document.addEventListener('visibilitychange', ()=>{
    if(document.hidden){ pauseAuto(); }
    else { v = virtualFromReal(realIndex); setTimeout(resumeAuto, 200); }
  });

  // 簡易アニメーション配慮
  const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
  function applyReduceMotion(){ if(prefersReduce.matches){ INTERVAL_MS = 5000; } }
  applyReduceMotion();
  prefersReduce.addEventListener?.('change', applyReduceMotion);

  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', setup);
  else setup();
})();
</script>
<!-- ===== Birds: JS (Auto-slide) END ===== -->

</main>
<!-- ===== Footer: HTML START ===== -->
<footer><div class="wrap"><small>© Chikumo</small></div></footer>
<!-- ===== Footer: HTML END ===== -->
<script>
// ===== Birds: JS (Fit to Viewport) =====
// Keep each bird fully visible by accounting for header and dots heights
(function(){
  const root = document.documentElement;
  const header = document.querySelector('header');
  const footer = document.querySelector('footer');
  const dotsArea = document.querySelector('.slider-controls');

  function setVars(){
    const hh = header ? Math.ceil(header.getBoundingClientRect().height) : 0;
    const dh = dotsArea ? Math.ceil(dotsArea.getBoundingClientRect().height) : 0;
    const fh = footer ? Math.ceil(footer.getBoundingClientRect().height) : 0;
    root.style.setProperty('--header-h', hh + 'px');
    root.style.setProperty('--dots-h', dh + 'px');
    root.style.setProperty('--footer-h', fh + 'px');
  }

  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', setVars);
  else setVars();
  window.addEventListener('load', setVars, {passive:true});
  window.addEventListener('resize', setVars, {passive:true});
  window.addEventListener('orientationchange', setVars, {passive:true});
})();
// ===== Birds: JS (Fit to Viewport) END =====
</script>
</body></html>
