<!doctype html><html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ちくも | 公式サイト</title>
<meta name="description" content="ちくも公式サイト。SVGレイヤーで再現性の高いキャラクター表現を公開。">
<link rel="canonical" href="https://chikumo.jp/">
<link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="manifest" href="/manifest.webmanifest">
<meta property="og:type" content="website"><meta property="og:title" content="ちくも | 公式サイト">
<meta property="og:description" content="SVGレイヤーで再現性の高いキャラクター表現を公開。">
<meta property="og:url" content="https://chikumo.jp/"><meta property="og:image" content="https://chikumo.jp/favicon.svg">
<meta name="twitter:card" content="summary_large_image">
<!-- 外部CSSが存在しないため読み込みを停止し、ベーススタイルを内包 -->
<!-- <link rel="stylesheet" href="/assets/site.css"> -->
<style>
  :root{--bg:#fff7f0;--ink:#222;--brand:#f4a300}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.7 system-ui,-apple-system,"Noto Sans JP",sans-serif}
  a{color:inherit;text-decoration:none}
  img,svg{max-width:100%;height:auto}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}
  header,footer{border-top:1px solid #0000000f;border-bottom:1px solid #0000000f;background:#fff8}
  h1{font-size:clamp(28px,4vw,40px);margin:0 0 12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
  .card{background:#fff;border:1px solid #0001;border-radius:12px;padding:16px}
  .btn{display:inline-block;padding:.6em 1em;border:1px solid #0002;border-radius:999px;background:var(--brand);color:#000}
  small,footer{color:#555}
  main{padding-inline:16px}
  /* header nav */
  nav.main{display:flex;gap:16px;align-items:center}
  nav.main .spacer{flex:1}
  nav.main .socials{display:flex;gap:12px;align-items:center}
  nav.main .socials svg{width:24px;height:24px;display:block;fill:#111;transition:opacity .2s ease}
  nav.main .socials a:hover svg{opacity:.7}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  /* stage sizing */
  #stage{width:clamp(260px,90vw,560px);margin:24px auto 48px;overflow:visible}
  #stage svg{display:block;width:100%;height:auto}
  /* fun background (optional) */
  body.fun-bg{
    --g1:#fff7f0; --g2:#fff4ff; --g3:#f0fff7;
    background: radial-gradient(1200px 600px at 10% 10%, var(--g1), transparent 70%),
                radial-gradient(800px 400px at 90% 20%, var(--g2), transparent 70%),
                radial-gradient(900px 500px at 30% 90%, var(--g3), transparent 70%), var(--bg);
    background-attachment: fixed;
  }
  #tagline{margin:6px 0 10px;color:#444}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:8px 0 8px}
  .controls .hint{opacity:.7;font-size:.9em}
  .btn{position:relative;cursor:pointer;transition:transform .08s ease,box-shadow .2s ease}
  .btn:active{transform:translateY(1px)}
  /* effects */
  .floater{position:fixed;left:0;top:100vh;font-size:22px;opacity:.85;pointer-events:none;animation:float-up linear forwards}
  @keyframes float-up{0%{transform:translate(var(--x,0),0) scale(1) rotate(0deg);opacity:0}10%{opacity:1}100%{transform:translate(calc(var(--x,0) + 40px), -110vh) scale(1.1) rotate(18deg);opacity:0}}
  .confetti-piece{position:fixed;left:0;top:0;width:8px;height:12px;opacity:.9;pointer-events:none;will-change:transform,opacity;animation:confetti-fall var(--dur,1200ms) ease-out forwards;transform:translate(var(--sx),var(--sy)) rotate(var(--rot))}
  @keyframes confetti-fall{0%{opacity:0;transform:translate(var(--sx),var(--sy)) rotate(var(--rot))}10%{opacity:1}100%{opacity:0;transform:translate(calc(var(--sx) + var(--dx)), calc(var(--sy) + var(--dy))) rotate(calc(var(--rot) + 540deg))}}
  .sparkle{position:fixed;left:0;top:0;font-size:14px;opacity:0;pointer-events:none;animation:spark .7s ease-out forwards}
  @keyframes spark{0%{opacity:0;transform:translate(var(--x),var(--y)) scale(.6)}20%{opacity:1}100%{opacity:0;transform:translate(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy))) scale(1)}}
  #stage.shake{animation:shake .35s ease-in-out}
  @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(5px)}60%{transform:translateX(-3px)}80%{transform:translateX(2px)}}
 </style>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"Organization","name":"Chikumo","url":"https://chikumo.jp/","logo":"https://chikumo.jp/favicon.svg","sameAs":["https://x.com/","https://www.youtube.com/"]}
</script>
</head><body>
<header><div class="wrap"><nav class="main"><a href="/">Home</a><a href="/about.html">About</a><a href="/works.html">Works</a><a href="/blog/">Blog</a><span class="spacer"></span><div class="socials">
  <a class="social" href="https://x.com/YN2005100816" target="_blank" rel="noopener noreferrer" aria-label="公式X">
    <svg viewBox="0 0 256 256" aria-hidden="true" focusable="false">
      <path d="M172 56h28l-63 73 72 71h-37l-55-55-47 55H42l68-80-73-64h39l51 47 45-47z" />
    </svg>
  </a>
  <a class="social" href="https://www.youtube.com/@chikumonogatari" target="_blank" rel="noopener noreferrer" aria-label="公式YouTube">
    <svg viewBox="0 0 256 256" aria-hidden="true" focusable="false">
      <defs>
        <mask id="ytm">
          <rect width="256" height="256" fill="#fff"/>
          <polygon points="110,90 190,128 110,166" fill="#000"/>
        </mask>
      </defs>
      <rect x="0" y="38" width="256" height="180" rx="36" mask="url(#ytm)" />
    </svg>
  </a>
  </div></nav></div></header>
<main class="wrap">
<h1>ちくも</h1>
<style>
  /* SVGのtransformが素直に効くように */
  #stage svg *, #stage * { transform-box: fill-box; transform-origin: center; }
  /* 上記は既存CSSを壊さず、要素単位のtransform原点を安定化 */
 </style>
<script src="js/eyes.js" defer></script>
<div id="stage">
  <svg data-full="1" id="_レイヤー_1" data-name="レイヤー 1" xmlns="http://www.w3.org/2000/svg" viewBox="-40 -40 284.99 342.72" preserveAspectRatio="xMidYMid meet" overflow="visible">
    <defs>
      <style>
        .cls-1 { fill: #eda97b; }
        .cls-2 { fill: #eca678; }
        .cls-3 { fill: #1a2728; }
        .cls-4 { fill: #15282c; }
        .cls-5 { fill: #f5e7c6; }
        .cls-6 { fill: #b1c3cc; }
        .cls-7 { fill: #d7d2be; }
        .cls-8 { fill: #162425; }
        .cls-9 { fill: #ea9e3f; }
        .cls-10 { fill: #eb9f3f; }
        .cls-11 { fill: #dbd4be; }
        .cls-12 { fill: #f3a43e; }
        .cls-13 { fill: #90a7b3; }
        /* 白パーツは透過に変更（背景白を残さないため） */
        .cls-14 { fill: none; }
        .cls-15 { fill: #de963d; }
        .cls-16 { fill: #12242a; }
        .cls-17 { fill: #e26b3b; }
        .cls-18 { fill: #829aa4; }
        .cls-19 { fill: #15282b; }
        .cls-20 { fill: #1c2929; }
      </style>
    </defs>
    <g id="NEAiP9.tif">
      <g>
        <!-- Removed large white backdrop path (id=bgWhite) to avoid white background fill -->
        <path class="cls-16" d="M96.6,0c10.55.81,15.51,5.73,18.55,15.33,20.03-8.15,27.89,4.01,29.27,22.56,32.52,11.85,59.49,36.87,60.57,74.28v20.66c-4.4,15.98-10.46,31.41-23.67,42.27-2.26,1.86-11.14,6.48-11.39,7.14-1.33,3.46,2.42,3.82,2.66,4.21,5.17,8.47,11.02,18.58,6.3,28.74-5.49,11.81-15.56,2.19-19.44,4.14-.73.37-4.81,10.68-8.28,14.21-4.3,4.39-9.16,5.17-12.54,7.77-.95,1.88-.96,1.96,0,3.69.79.65,4.84,1.77,5.19,2.72.72,2,.25,9.16-2.24,10.56-.76.56-1.49,1.06-2.21,1.48-9.03,3.58-26.69,1.79-22.86-11.81h-25.44c-1.47,0-.93,5.59-1.66,7.19-4.4,9.63-36.59,8.64-26.27-7.79.52-.82,3.58-1.96,3.97-2.36.44-1.42.05-2.49-.74-3.69-3.31-2.49-8.62-4.02-11.55-6.89-3.12-3.05-7.75-14.69-8.52-15.09-2.49-1.28-12.03,6.51-18.68-2.34-6.05-8.04-.25-22.74,5.01-30.1.6-.85,3.17-.64,3.42-1.01,2.79-4.17-8.13-7.8-11.12-10.3C-17.74,139.85.21,65.96,48.49,44.32c2.46-1.19,16-4.45,16.85-5.13s1.89-14.69,2.72-17.93c2.95-11.54,12.78-20.19,24.85-21.26h3.69Z"/>
        <path class="cls-14" d="M96.6,0h108.4v112.17c-4.24-26.29-15.21-47.39-38.01-61.96-4.32-2.76-22.73-10.11-23.53-11.13-2.91-3.72-.15-16.43-8.15-22.1-8.84-6.28-20.09.6-21,0-.59-.39-3.2-9.25-6.72-12.11l-10.99-4.87Z"/>
        <!-- 足元の灰色ノイズ（汚れ）を削除 -->
        <path class="cls-5" d="M134.2,43.54c58.45,11.86,89.77,88.13,40.16,128.38-2.11,1.71-13.29,7.9-13.52,8.67-.5,1.69,10.64,14.4,12.03,19.44,1.38,4.98,2.94,16.76-5.78,15.45-10.1-1.52-3.91-19.02-10.26-16.11-2.27,1.04-.95,23.19-13.1,32.66-19.25,15.01-82.07,14.22-91.74-13.61-1.47-4.22-.63-17.64-3.07-18.39-4.84-1.48-3.66,8.3-4.28,10.32-1.48,4.79-9.12,7.35-12.24,2.58-7.54-11.51,13.46-29.59,13.21-31.59-.23-1.82-14.64-9.42-17.95-12.38-46.29-41.29-11.04-116.15,46.81-126.17l1.83-1.79c18.56-2.4,37.63-2.22,56.12.69l1.78,1.84Z"/>
        <path class="cls-17" d="M134.2,43.54c-16.24-3.3-43.47-3.55-59.73-.74-5.87-16.4,2.86-37.45,22.54-34.73,13.15,1.81,10.81,20.35,14.84,21.38,2.6.66,6.24-7.11,11.1-7.88,12-1.9,15.33,13.02,11.25,21.97Z"/>
        <path class="cls-15" d="M80.99,245.13c.23.21,3.1,5.18,3.11,5.49.24,6.22-14.64,5.94-16.65,2.52s6.52-4.65,6.93-5.28c.57-.87-.26-3.86.11-4.33.21-.26,6.26,1.37,6.51,1.59Z"/>
        <path class="cls-10" d="M131.25,243.53c.15.13-.14,3.07.8,4.01,1.56,1.56,13.72,6.73,1.04,7.78-21.2,1.75-4.57-14.15-1.84-11.79Z"/>
        <path class="cls-2" d="M164.31,124.89c17.15-1.88,21.87,25.65,4.14,28.55-22.15,3.62-23.57-26.43-4.14-28.55Z"/>
        <path class="cls-8" d="M116.24,152.49c-18.33,16.32-42.94-11.17-26.04-26.05,18.86-16.61,42.46,11.43,26.04,26.05Z"/>
        <path class="cls-1" d="M48.66,147.6c-.36.34,3,3.64-6.29,5.16-.24.04-.45-1.52-.72-1.52-1.65.03-2.86,1.59-3.67,1.47-18.78-2.63-14.76-31.54,5.84-27.94,9.7,1.7,14.25,14.66,8.22,22.14-.73.9-3.24.55-3.38.69Z"/>
        <path class="cls-4" d="M76.27,129.46c-16.34,11.58-27.65-15.68-12.31-21.54,14.83-5.66,24.7,12.76,12.31,21.54Z"/>
        <path class="cls-19" d="M134.74,107.18c18.82-3.47,19.86,24.58,2.67,24.86-14.74.24-16.23-22.36-2.67-24.86Z"/>
        <path class="cls-3" d="M147.97,86.58c7.68,8.94-6.09,2.5-7.68,2.15-2.63-.58-9.64,1.1-9.81-2.04-.29-5.11,14.24-3.9,17.49-.12Z"/>
        <path class="cls-20" d="M74.33,85.01c3.71,5.44-6.4,3.2-8.28,3.61-2.27.49-7.96,4.94-9.22,1.7-2.12-5.44,14.69-9.43,17.51-5.31Z"/>
        <path class="cls-12" d="M114.97,136.45c-.86,1.34-32.39,5.48-21-5.88,7.65-7.62,24.51.39,21,5.88Z"/>
        <path class="cls-9" d="M115.77,142.43c.97,13.9-29.04,9.13-25.08.38.52-1.14,21.76,2.17,25.08-.38Z"/>
        <path class="cls-7" d="M72.05,113.73c3.7-.91,4.33,5.81.58,5.83-2.98.01-3.58-5.09-.58-5.83Z"/>
        <path class="cls-11" d="M142.87,114.58c2.99,3.01-2.42,6.95-4.65,3.52-1.79-2.76,2.15-6.03,4.65-3.52Z"/>
      </g>
    </g>
  </svg>
 </div>
<p><a class="btn" href="/works.html">作品を見る</a></p>

<!-- Chikumo Sky Dive: inline single-file implementation -->
<section id="chikumo-game" class="wrap" aria-label="Chikumo Sky Dive">
  <style>
    /* Game container (scoped) */
    #chikumo-game{max-width:860px;margin:24px auto}
    #chikumo-game .game-shell{position:relative;margin:0 auto;border-radius:16px;box-shadow:0 8px 24px #0002, 0 2px 6px #0001;background:#0f1020;color:#fff;overflow:hidden}
    #chikumo-game .topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#0a0b18;border-bottom:1px solid #ffffff12}
    #chikumo-game .topbar .title{font-weight:700}
    #chikumo-game .controls{display:flex;gap:8px;align-items:center}
    #chikumo-game .controls .btn{background:#232646;color:#fff;border-color:#ffffff26}
    #chikumo-game .controls .btn:hover{filter:brightness(1.1)}
    #chikumo-game .canvas-wrap{position:relative}
    #chikumo-game canvas#game{display:block;width:100%;height:auto;background:#0e0f1c}
    #chikumo-game .hud{position:absolute;inset:0;pointer-events:none}
    #chikumo-game .hud .score{position:absolute;left:12px;top:12px;font-weight:800;background:#0006;padding:6px 10px;border-radius:12px}
    #chikumo-game .hud .best{position:absolute;right:12px;top:12px;background:#0006;padding:6px 10px;border-radius:12px}
    #chikumo-game .hud .pause-btn{position:absolute;right:12px;bottom:12px;pointer-events:auto}
    #chikumo-game .card{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:#161830;border:1px solid #ffffff1a;border-radius:14px;box-shadow:0 10px 30px #0004;padding:18px 16px;min-width:260px;text-align:center}
    #chikumo-game .card h2{margin:6px 0 8px}
    #chikumo-game .card p{margin:4px 0 10px;color:#ddd}
    #chikumo-game .row{display:flex;justify-content:center;gap:8px;flex-wrap:wrap}
    #chikumo-game .hidden{display:none}
    #chikumo-game .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    @media (max-width:768px){
      #chikumo-game .controls .btn{font-size:1.05em}
      #chikumo-game .card{min-width:240px}
    }
  </style>

  <div class="game-shell" role="region" aria-label="Chikumo Sky Dive Game">
    <div class="topbar">
      <div class="title">Chikumo Sky Dive</div>
      <div class="controls">
        <button id="btn-mute" class="btn" role="button" aria-label="ミュート切替">🔊 Mute</button>
      </div>
    </div>
    <div class="canvas-wrap">
      <canvas id="game" width="480" height="800" aria-label="ゲームキャンバス"></canvas>
      <div class="hud" aria-hidden="true">
        <div class="score" id="score">0</div>
        <div class="best" id="best">Best: 0</div>
        <button id="btn-pause" class="btn pause-btn" role="button" aria-label="一時停止">⏸ Pause</button>
      </div>
      <div id="ui-title" class="card" role="dialog" aria-modal="true">
        <h2>Chikumo Sky Dive</h2>
        <p>タップ/クリック/Space/↑ でフラップ。柱の隙間を抜けよう！</p>
        <div class="row">
          <button id="btn-play" class="btn" role="button" aria-label="プレイ開始">▶ PLAY</button>
        </div>
      </div>
      <div id="ui-over" class="card hidden" role="dialog" aria-modal="true">
        <h2>Game Over</h2>
        <p id="final">Score: 0</p>
        <p id="final-best">Best: 0</p>
        <div class="row">
          <button id="btn-retry" class="btn" role="button" aria-label="もう一度">↻ RETRY</button>
        </div>
      </div>
      <div id="live" class="sr-only" aria-live="polite"></div>
    </div>
  </div>

  <script>
  (()=>{'use strict';
    // ---------- Config ----------
    const VIRTUAL_W = 480, VIRTUAL_H = 800; // logical canvas size
    const GRAVITY = 0.45, FLAP = 8.8;
    const PIPE_SPEED_BASE = 2.6, PIPE_ACCEL = 0.0005;
    const PIPE_GAP_BASE = 190, PIPE_GAP_MIN = 120; // shrinks with score
    const PIPE_WIDTH = 70, SPAWN_INTERVAL = 1400; // ms
    const NOODLE_CHANCE = 0.28; // chance per spawn
    const SCORE_PER_NOODLE = 5;
    const MAX_PARTICLES = 120;

    // ---------- Elements ----------
    const root = document.getElementById('chikumo-game');
    const canvas = root.querySelector('#game');
    const ctx = canvas.getContext('2d');
    const uiTitle = root.querySelector('#ui-title');
    const uiOver = root.querySelector('#ui-over');
    const scoreEl = root.querySelector('#score');
    const bestEl = root.querySelector('#best');
    const finalEl = root.querySelector('#final');
    const finalBestEl = root.querySelector('#final-best');
    const live = root.querySelector('#live');
    const btnPlay = root.querySelector('#btn-play');
    const btnRetry = root.querySelector('#btn-retry');
    const btnPause = root.querySelector('#btn-pause');
    const btnMute = root.querySelector('#btn-mute');

    // ---------- State ----------
    let state = 'title'; // 'title' | 'playing' | 'paused' | 'gameover'
    let score = 0, best = +localStorage.getItem('best')||0; bestEl.textContent = `Best: ${best}`;
    let tPrev = 0, rafId = 0, spawnAt = 0, speed = PIPE_SPEED_BASE;
    let blinkAt = scheduleBlink();
    let muted = false;
    const parallax = makeParallax();
    const pipes = []; // {x,gapY,passed}
    const noodles = []; // {x,y,taken}
    const particles = []; // {x,y,vx,vy,life,color}

    const bird = { x: Math.floor(VIRTUAL_W*0.34), y: Math.floor(VIRTUAL_H*0.5), r: 18, vy: 0 };

    // ---------- Audio ----------
    let AC = window.AudioContext||window.webkitAudioContext; let actx=null;
    function ensureAudio(){ if(!actx){ try{ actx=new AC(); }catch(e){} } }
    function beep(type){ if(muted) return; ensureAudio(); if(!actx) return; const now=actx.currentTime; const osc=actx.createOscillator(); const g=actx.createGain();
      let f=440, d=0.08; if(type==='flap'){f=520; d=0.06}else if(type==='score'){f=760; d=0.09}else if(type==='over'){f=220; d=0.25}
      osc.frequency.setValueAtTime(f,now); g.gain.setValueAtTime(0.0001,now); g.gain.exponentialRampToValueAtTime(0.25,now+0.01); g.gain.exponentialRampToValueAtTime(0.0001,now+d);
      osc.type='square'; osc.connect(g); g.connect(actx.destination); osc.start(now); osc.stop(now+d+0.02);
    }

    // ---------- Utilities ----------
    const rand=(a,b)=>a+Math.random()*(b-a);
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    function circleRectHit(cx,cy,r, rx,ry,rw,rh){ // clamp to rect & dist
      const nx=clamp(cx,rx,rx+rw), ny=clamp(cy,ry,ry+rh); const dx=cx-nx, dy=cy-ny; return (dx*dx+dy*dy) <= r*r;
    }
    function scheduleBlink(){ return performance.now() + 2000 + Math.random()*4000; }
    function makeParallax(){
      const layers=[{n:20,s:0.3, r:[1,2], a:0.25},{n:14,s:0.6, r:[2,3], a:0.35},{n:8,s:1.1, r:[3,5], a:0.5}];
      return layers.map((L,i)=>({
        dots:Array.from({length:L.n},()=>({x:Math.random()*VIRTUAL_W,y:Math.random()*VIRTUAL_H,r:rand(L.r[0],L.r[1])})),
        speed:L.s, alpha:L.a
      }));
    }

    // ---------- Resize (fit to width) ----------
    function resize(){
      const wrap = root.querySelector('.game-shell');
      const w = wrap.clientWidth; const ratio = VIRTUAL_H/VIRTUAL_W; const h = Math.round(w*ratio);
      canvas.width = VIRTUAL_W; canvas.height = VIRTUAL_H; // logical
      canvas.style.width = w+'px'; canvas.style.height = h+'px';
    }
    new ResizeObserver(resize).observe(root.querySelector('.game-shell'));
    resize();

    // ---------- Game Control ----------
    function reset(){
      score=0; scoreEl.textContent='0'; bestEl.textContent = `Best: ${best}`;
      bird.y = Math.floor(VIRTUAL_H*0.5); bird.vy=0; speed=PIPE_SPEED_BASE; pipes.length=0; noodles.length=0; particles.length=0;
      spawnAt = performance.now()+600; blinkAt=scheduleBlink();
      uiOver.classList.add('hidden'); uiTitle.classList.add('hidden');
    }
    function start(){ reset(); state='playing'; live.textContent='Game Start'; loop(performance.now()); }
    function gameOver(){ state='gameover'; live.textContent='Game Over'; finalEl.textContent = `Score: ${score}`; if(score>best){best=score; localStorage.setItem('best',best);} finalBestEl.textContent = `Best: ${best}`; uiOver.classList.remove('hidden'); beep('over'); cancelAnimationFrame(rafId); }
    function togglePause(){ if(state==='playing'){ state='paused'; live.textContent='Paused'; cancelAnimationFrame(rafId); } else if(state==='paused'){ state='playing'; live.textContent='Resumed'; loop(performance.now()); } }

    // ---------- Spawning ----------
    function spawnPipe(){
      const gap = Math.max(PIPE_GAP_MIN, PIPE_GAP_BASE - score*2);
      const margin = 80; const gy = Math.round(rand(margin, VIRTUAL_H - margin - gap));
      pipes.push({ x: VIRTUAL_W + PIPE_WIDTH, gapY: gy, gapH: gap, passed:false });
      if(Math.random() < NOODLE_CHANCE){
        noodles.push({ x: VIRTUAL_W + PIPE_WIDTH + 120, y: gy + gap*0.5, taken:false });
      }
    }

    // ---------- Drawing ----------
    function drawBackground(){
      ctx.fillStyle = '#0e0f1c'; ctx.fillRect(0,0,VIRTUAL_W,VIRTUAL_H);
      parallax.forEach((L,i)=>{ ctx.globalAlpha=L.alpha; ctx.fillStyle='#a9b4ff'; L.dots.forEach(d=>{ ctx.beginPath(); ctx.arc(d.x,d.y,d.r,0,Math.PI*2); ctx.fill(); }); ctx.globalAlpha=1; });
    }
    function drawPipes(){
      ctx.fillStyle = '#2bd4a7';
      pipes.forEach(p=>{
        const topH = p.gapY; const botY = p.gapY + p.gapH; const botH = VIRTUAL_H - botY;
        // rounded rectangles
        roundRect(ctx, p.x, 0, PIPE_WIDTH, topH, 10); ctx.fill();
        roundRect(ctx, p.x, botY, PIPE_WIDTH, botH, 10); ctx.fill();
      });
    }
    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
    function drawNoodles(){ ctx.strokeStyle='#ffcc66'; ctx.lineWidth=5; noodles.forEach(n=>{ if(n.taken) return; ctx.beginPath(); ctx.arc(n.x,n.y,10,Math.PI*0.2,Math.PI*1.7,false); ctx.stroke(); }); }
    function drawParticles(){ particles.forEach(pt=>{ ctx.globalAlpha=Math.max(0,pt.life/1); ctx.fillStyle=pt.color; ctx.fillRect(pt.x,pt.y,3,3); ctx.globalAlpha=1; }); }
    function drawBird(){ const b=bird; // body
      ctx.save(); ctx.translate(b.x,b.y);
      // tilt by velocity
      ctx.rotate(clamp(b.vy,-10,10)*0.03);
      // body
      ctx.fillStyle='#fff'; ctx.beginPath(); ctx.ellipse(0,0,b.r*1.05,b.r*0.9,0,0,Math.PI*2); ctx.fill();
      // beak
      ctx.fillStyle='#f3a43e'; ctx.beginPath(); ctx.moveTo(b.r*0.9,0); ctx.lineTo(b.r*1.5,-5); ctx.lineTo(b.r*1.5,5); ctx.closePath(); ctx.fill();
      // eye (blink)
      const now=performance.now(); const blinking = now < blinkAt && (blinkAt - now) < 200; if(now>=blinkAt){ blinkAt=scheduleBlink(); }
      ctx.fillStyle='#111';
      if(blinking){ ctx.fillRect(b.r*0.3,-2,6,2); } else { ctx.beginPath(); ctx.arc(b.r*0.3,-2,3,0,Math.PI*2); ctx.fill(); }
      ctx.restore();
    }

    // ---------- Update ----------
    function update(dt){
      // Parallax
      parallax.forEach(L=>{ L.dots.forEach(d=>{ d.x-=L.speed*speed*0.6; if(d.x<-6){ d.x=VIRTUAL_W+6; d.y=Math.random()*VIRTUAL_H; } }); });
      // Bird physics
      bird.vy += GRAVITY; bird.y += bird.vy; if(bird.y < bird.r){ bird.y=bird.r; bird.vy=0; }
      if(bird.y > VIRTUAL_H - bird.r){ bird.y=VIRTUAL_H - bird.r; gameOver(); return; }
      // Pipes
      speed += PIPE_ACCEL*dt; pipes.forEach(p=>{ p.x -= speed; });
      // Score when center crosses
      pipes.forEach(p=>{ const centerX = p.x + PIPE_WIDTH/2; if(!p.passed && centerX < bird.x){ p.passed=true; score++; scoreEl.textContent=String(score); beep('score'); burst(bird.x, bird.y, '#2bd4a7'); }});
      // Remove offscreen
      while(pipes.length && pipes[0].x + PIPE_WIDTH < -10) pipes.shift();
      // Spawn
      const now=performance.now(); if(now>=spawnAt){ spawnPipe(); spawnAt = now + SPAWN_INTERVAL; }
      // Collisions
      for(const p of pipes){
        const topH=p.gapY; const botY=p.gapY+p.gapH; if(circleRectHit(bird.x,bird.y,bird.r, p.x,0,PIPE_WIDTH,topH) || circleRectHit(bird.x,bird.y,bird.r, p.x,botY,PIPE_WIDTH,VIRTUAL_H-botY)){ gameOver(); return; }
      }
      // Noodles
      noodles.forEach(n=>{ n.x -= speed; if(!n.taken && Math.hypot(n.x-bird.x, n.y-bird.y) < bird.r+10){ n.taken=true; score+=SCORE_PER_NOODLE; scoreEl.textContent=String(score); beep('score'); burst(n.x,n.y,'#ffcc66'); }});
      while(noodles.length && (noodles[0].x < -30 || noodles[0].taken)) noodles.shift();
      // Particles
      for(let i=particles.length-1;i>=0;i--){ const pt=particles[i]; pt.x+=pt.vx; pt.y+=pt.vy; pt.vy+=0.02; pt.life-=dt*0.002; if(pt.life<=0) particles.splice(i,1); }
    }

    function burst(x,y,color){ const count=12; for(let i=0;i<count;i++){ if(particles.length>MAX_PARTICLES) break; const a=Math.random()*Math.PI*2; const s=rand(1,3); particles.push({x:x,y:y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:1,color}); } }

    // ---------- Loop ----------
    function loop(ts){ if(state!=='playing') return; const dt = tPrev? (ts - tPrev) : 16; tPrev=ts; ctx.clearRect(0,0,canvas.width,canvas.height); drawBackground(); drawNoodles(); drawPipes(); drawParticles(); drawBird(); update(dt); rafId = requestAnimationFrame(loop); }

    // ---------- Input ----------
    function flap(){ if(state==='title'){ start(); } if(state!=='playing') return; bird.vy = -FLAP; beep('flap'); }
    function onKey(e){ if(e.repeat) return; const k=e.key.toLowerCase(); if(k==='p'){ togglePause(); } else if(k===' '||k==='arrowup'){ e.preventDefault(); flap(); } else if(k==='enter'){ if(state==='title'||state==='gameover'){ start(); } } }
    function onClick(){ if(state==='paused'){ togglePause(); return; } flap(); }
    window.addEventListener('keydown', onKey);
    canvas.addEventListener('pointerdown', onClick, {passive:true});

    // ---------- Buttons ----------
    btnPlay.addEventListener('click', start);
    btnRetry.addEventListener('click', start);
    btnPause.addEventListener('click', togglePause);
    btnMute.addEventListener('click', ()=>{ muted=!muted; btnMute.textContent = muted? '🔈 Unmute':'🔊 Mute'; live.textContent = muted? 'Muted':'Unmuted'; });

    // ---------- Expose debug ----------
    window.__gameDebug = { setSpeed(n){ speed=n; }, addScore(n){ score+=n; scoreEl.textContent=String(score); } };

    // Title state initially
    uiTitle.classList.remove('hidden');
  })();
  </script>
</section>
</main>
<footer><div class="wrap"><small>© Chikumo</small></div></footer>
<script src="/lib/layout.js" defer></script>
</body></html>
